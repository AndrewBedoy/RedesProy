<div [ngSwitch]="tipo">

  <div *ngSwitchCase="'administrador'">
    <h3 class="text-center mb-4" style="font-size: 20px;">{{saludo}}, administrador {{usuario.nombre}}</h3>
  </div>

  <div *ngSwitchCase="'paciente'">
    <h3 class="text-center">{{saludo}}, paciente {{usuario.nombre}}</h3>
    
    <div [ngSwitch]="tabla" class="my-3 ">
      <div *ngSwitchCase="'tCitas'">
        <table class="table table-striped table-bordered mx-auto text-center" style="width: 80%; align-items: center;">
          <thead title="Citas">
            <tr>
              <th>Cita</th>
              <th>Fecha</th>
              <th>Doctor</th>
              <th>Hora</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cita of citas; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ cita.fecha }}</td>
              <td>{{ cita.nombre + ' ' + cita.apellido_P }}</td>
              <td>{{ cita.hora }}</td>
              <td *ngIf="cita.estado == 'C'" style="color: green">Atendido</td>
              <td *ngIf="cita.estado == 'P'" style="color: red">Pendiente</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div *ngSwitchCase="'doctor'">
    <h3 class="text-center">{{saludo}}, doctor {{usuario.nombre}}</h3>
    <div class="text-center my-3">
      <a class="btn btn-primary mx-5" (click)="verPacientes()">Ver pacientes</a>
      <a class="btn btn-primary mx-5" (click)="verAlergiasPacientes()">Ver alergias de pacientes</a>
      <a class="btn btn-primary mx-5" (click)="verExpediente()">Ver expedientes propios</a>
      <a class="btn btn-primary mx-5" (click)="verCitas()">Ver citas propias</a>
    </div>

    <div [ngSwitch]="tabla" class="my-3 ">
      <div *ngSwitchCase="'tPacientes'">
        <div class="table-responsive mx-auto text-center">
          <table class="table table-striped table-bordered mx-auto text-center" style="width: 80%; align-items: center;">
            <thead title="Pacientes">
              <tr>
                <th>Nombre completo</th>
                <th>Dirección</th>
                <th>Correo</th>
                <th>Telefono</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let paciente of paginatedPacientes">
                <td>{{ paciente.nombre + ' ' + paciente.apellido_P + ' ' + paciente.apellido_m }}</td>
                <td>{{ paciente.direccion }}</td>
                <td>{{ paciente.correo }}</td>
                <td>{{ paciente.telefono }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li class="page-item" *ngFor="let page of [].constructor(Math.ceil(totalItems / itemsPerPage)); let i = index" [class.active]="i + 1 === currentPage">
              <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === Math.ceil(totalItems / itemsPerPage)">
              <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <div *ngSwitchCase="'tAlergias'" class="table-responsive mx-auto text-center">
        <table class="table table-striped table-bordered mx-auto text-center" style="width: 80%; align-items: center;">
          <thead title="Alergias por cada paciente">
            <tr>
              <th>Nombre</th>
              <th>Correo</th>
              <th>Telefono</th>
              <th>Alergias</th>
              <th>Nueva alergia</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let paciente of paginatedPacientes">
              <td>{{ paciente.nombre + ' ' + paciente.apellido_P + ' ' + paciente.apellido_m }}</td>
              <td>{{ paciente.correo }}</td>
              <td>{{ paciente.telefono }}</td>
              <td>
                <ng-container *ngIf="alergiasPorPaciente.has(paciente.id)">
                  <span [ngStyle]="{'color': 'red'}">
                    {{ alergiasPorPaciente.get(paciente.id)?.join(', ') }}
                  </span>
                </ng-container>
                <ng-container *ngIf="!alergiasPorPaciente.has(paciente.id)">
                  Sin alergias
                </ng-container>
              </td>
              <td>
                <button type="button" class="btn btn-primary" (click)="abrirModal(paciente)" data-toggle="modal" data-target="#nuevaAlergia" data-whatever="">
                  Registrar alergia
                </button>                
                <div class="modal fade" id="nuevaAlergia" tabindex="-1" role="dialog" aria-labelledby="nuevaAlergiaLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="nuevaAlergiaLabel">Nueva alergia para {{pacienteActual?.nombre}}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form>
                          <div class="form-group">
                            <select [(ngModel)]="alergiaSeleccionada" [ngModelOptions]="{standalone: true}">
                              <option *ngFor="let alergia of alergia_descripcion" [value]="alergia.id">{{ alergia.nombre }}</option>
                            </select>                          
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" (click)="registrarAlergia(pacienteActual.id)">
                          Registrar Alergia
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li class="page-item" *ngFor="let page of [].constructor(Math.ceil(totalItems / itemsPerPage)); let i = index" [class.active]="i + 1 === currentPage">
              <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === Math.ceil(totalItems / itemsPerPage)">
              <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>      
      <div *ngSwitchCase="'tExpedientes'">
        <table class="table table-striped table-bordered mx-auto text-center" style="width: 80%; align-items: center;">
          <thead title="Expedientes propios">
            <tr>
              <th>Expediente</th>
              <th>Paciente</th>
              <th>Fecha</th>
              <th>Enfermedad</th>
              <th>Descripción</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let expediente of expedientes; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ expediente.paciente }}</td>
              <td>{{ expediente.fecha }}</td>
              <td>{{ expediente.enfermedad }}</td>
              <td>{{ expediente.descripcion }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngSwitchCase="'tCitas'">
        <table class="table table-striped table-bordered mx-auto text-center" style="width: 80%; align-items: center;">
          <thead title="Citas">
            <tr>
              <th>Cita</th>
              <th>Paciente</th>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cita of citas; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ cita.paciente + cita.apellido_p }}</td>
              <td>{{ cita.fecha }}</td>
              <td>{{ cita.hora }}</td>
              <td *ngIf="cita.estado == 'C'" style="color: green">Atendido</td>
              <td *ngIf="cita.estado == 'P'" style="color: red">Pendiente</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngSwitchDefault>
    <h3 class="text-center"><a routerLink="/sesion">Inicia sesión para continuar</a></h3>
  </div>

</div>
